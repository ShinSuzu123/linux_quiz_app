<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>LPIC lv.1 アタック!</title>
    <link href="https://fonts.googleapis.com/earlyaccess/nicomoji.css" rel="stylesheet">
    <link href="../common/style.css" rel="stylesheet" type="text/css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
    <header class="header">
        <h1 class="quiz-logo"><a href="../101_quiz.html">LPIC lv.1 アタック!</a></h1>
        <nav class="nav">
            <ul class="list">
                <li class="item"><a href="../other/mypage.html">マイページ</a></li>
                <li class="item"><a href="login.html">ログイン</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h2>コマンド基礎とファイル操作</h2>

        <div id="questions-container"></div>

        <script>
            $(document).ready(function() {
                // カテゴリーを指定して問題を取得
                var category = "コマンド基礎とファイル操作"; // 取得するカテゴリを指定する
                $.get("get_questions.php?category=" + category, function(data) {
                    for (var i = 0; i < data.length; i++) {
                        var question = data[i];
                        var questionHTML = '<div class="question" id="question ' + i + '">';
                        //問題
                        questionHTML += '<h3>' + ' ■ ' + question.question_text + '</h3>';
                        //選択肢
                        questionHTML += '<form class="answer-form" name="question_id" value="' + question.id + '">';
                        questionHTML += '<input type="radio" name="ans" value="1"> ' + question.option1;
                        questionHTML += '<input type="radio" name="ans" value="2"> ' + question.option2;
                        questionHTML += '<input type="radio" name="ans" value="3"> ' + question.option3;
                        questionHTML += '<input type="radio" name="ans" value="4"> ' + question.option4;
                        questionHTML += '</form>';
                        //結果と解説
                        questionHTML += '<div class="result" id="result' + i + '"></div>';
                        questionHTML += '<div class="explanation" id="explanation' + i +'"></div>';
                        questionHTML += '</div>';

                        $("#questions-container").append(questionHTML);
                    }

                    // 「完了」ボタンの配置
                    var finishButton = '<button id="finish-quiz">完了する</button>';
                    $("#questions-container").append(finishButton);

                    // 回答送信
                    $(".answer-form").submit(function(event) {
                        event.preventDefault();

                        var formData = $(this).serialize();
                        var questionID = $(this).find('input[name="question_id"]').val();
                        
                        // ラジオボタンが選択されているかの確認
                        if (!$('input[name="ans"]:checked').val()) {
                            alert("回答してない問題があります");
                            return; // 回答してない問題があれば処理を中断できる。
                        }

                        $.post("check_answer.php", formData, function(data) {
                            $("#result" + questionID).html(data.result);
                            $("#explanation" + questionID).html(data.explanation);
                        }, 'json');
                    });

                    // 「完了」ボタンが押された後の処理
                    $("#finish-quiz").click(function() {
                        //全ての回答フォームを一斉に送信
                        $(".answer-form").submit();
                        // 「完了」ボタンを非表示にする
                        $(this).hide();
                    });
                });
            });
        </script>
    </main>

    <footer class="footer">
        <ul class="menu">
            <li><a href="../other/about.html">このサイトについて</a></li>
            <li><a href="../other/inquiry.html">お問い合わせ</a></li>
        </ul>
    </footer>
</body>
</html>
