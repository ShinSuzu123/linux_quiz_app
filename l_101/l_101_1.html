<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>LPIC lv.1 アタック!</title>
    <link href="https://fonts.googleapis.com/earlyaccess/nicomoji.css" rel="stylesheet">
    <link href="../common/style.css" rel="stylesheet" type="text/css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
    <header class="header">
        <h1 class="quiz-logo"><a href="../101_quiz.html">LPIC lv.1 アタック!</a></h1>
        <nav class="nav">
            <ul class="list">
                <li class="item"><a href="../other/mypage.html">マイページ</a></li>
                <li class="item"><a href="login.html">ログイン</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h2>コマンド基礎とファイル操作</h2>

        <!-- 問題一覧 -->
        <div id="questions-container"></div>

        <!-- 完了ボタン -->
        <button id="finish-quiz">完了</button>

        <!-- エラーメッセージ -->
        <!-- <div id="error-message"></div> -->

        <script>
            $(document).ready(function() {
                // カテゴリーを指定して問題を取得
                var category = "コマンド基礎とファイル操作"; // 取得するカテゴリを指定する
                $.get("get_questions.php?category=" + category, function(data) {
                // $.get("get_questions.php", {category: category}, function(data) {

                    // データが存在しかつ０より大きい場合取得
                    if (data && data.length > 0) {
                        // 問題データが正常に取得できた場合の処理
                        for (var i = 0; i < data.length; i++) {
                            var question = data[i];

                            // データが取得できているかコンソール上で確認(のちに消去)
                            console.log(question);

                            var questionHTML = '<div class="question">';
                            // 問題
                            questionHTML += '<h4>' + (i + 1) + '.' + question.question_text + '</h4>';
                            // 選択肢
                            questionHTML += '<form class="answer-form" action="ans_questions.php" method="post">';
                            questionHTML += '<input type="hidden" name="question_id" value="' + question.id + '">';
                            questionHTML += ' <input type="radio" name="ans" value="1"> ' + question.option1;
                            questionHTML += ' <input type="radio" name="ans" value="2"> ' + question.option2;
                            questionHTML += ' <input type="radio" name="ans" value="3"> ' + question.option3;
                            questionHTML += ' <input type="radio" name="ans" value="4"> ' + question.option4;
                            questionHTML += '</input>';
                            questionHTML += '</form>'

                            // questions-containerに追加
                            $("#questions-container").append(questionHTML);
                        }
                    } else {
                        //問題データが取得できなかった場合のエラーハンドリング
                        console.log("問題データが取得でません");
                    }

                    // 解答送信処理
                    $('.answer-form').submit(function(event) {
                        event.preventDefault();
                        
                        var formData = $(this).serialize();

                        // 解答送信
                        $.post("ans_questions.php", formData, function(data) {
                            // 解答結果が取得できた場合は遷移
                            window.location.href = "l_101_1_ans.html";
                        }, 'json');
                    });
                });

                //「完了」ボタンが押された後の処理
                $("#finish-quiz").click(function() {
                    // すべての解答が選択されているかチェック
                    var allAnswers = true;

                    $(".answer-form").each(function() {
                        // 各問題ごとに解答が選択されているかチェック
                        if ($(this).find('input[type="radio"]:checked').length === 0) {
                            allAnswers = false;
                            return false; // 一つでも未選択の場合は処理終了
                        }
                    });

                    if (allAnswers) {
                        // チェックされている場合は遷移
                        window.location.href = "l_101_1_ans.html";
                    } else {
                        // 選択してない場合アラート出す
                        alert("解答を選択してください");
                    }
                });
            });
        </script>
    </main>

    <footer class="footer">
        <ul class="menu">
            <li><a href="../other/about.html">このサイトについて</a></li>
            <li><a href="../other/inquiry.html">お問い合わせ</a></li>
        </ul>
    </footer>
</body>
</html>
